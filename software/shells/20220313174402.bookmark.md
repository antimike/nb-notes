# Rash: The Reckless Racket Shell (docs.racket-lang.org)

<https://docs.racket-lang.org/rash/index.html>

## Comment

Rash: Shell written in Racket

## Tags

#racket #to-try #shell

## Content

Rash: The Reckless Racket Shell {#rash-the-reckless-racket-shell .reader-title}
===============================

------------------------------------------------------------------------

8.4

William Hatch \<<william@hatch.uno>\>

Rash, adj 1. Hurrying into action or assertion without due caution and regardless of prudence, hasty, reckless, precipitate. "A rash programmer is likely to produce shell scripts."

### 1` `[]{#(part._.Stability)}Stability

Some things in Rash are not entirely stable. However, things from the GPCE paper are all stable. If any of them don't work at any point it's a bug. Unstable things should all be labelled in the documentation.

Rash is definitely usable as an interactive shell/repl as well as for writing scripts, and I'm anxious to hear feedback from more users to understand what they like and what can be improved.

### 2` `[]{#(part._.Rash_.Guide)}Rash Guide

Rash is a shell language embedded in Racket. It has a concrete syntax that is amenable to quick and easy interactions without lots of punctuation overhead. It aims to allow shell-style interaction and programming to be freely mixed with more general-purpose Racket code. Like shells you can use it as a day-to-day interface for computing, run programs, wire processes together, etc. You can copy interactive code into a file and have a working script. Then you can generalize from there. However, you have access to all of Racket, its data structures, its libraries, its macro system, and its other DSLs as you make your scripts more general. Also it allows shell-style process wrangling to be mixed with Racket code, pipelines of functions that pass objects, and much more. You can gradually move between shell-style Rash code and more normal and general Racket code in different parts of a script, or throw verbatim interactions directly into existing programs as you explore the solution space.

Here follows a quick overview that assumes some knowledge of shell languages like Bash as well as Racket.

Rash can do the sorts of things you expect from shell languages, and a lot of cues for syntax have been taken from traditional Bourne-derived shells. The following program works as you would expect.

> > > Note that Rash is not remotely Posix Shell compliant.

>   ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
>   \#!/usr/bin/env racket
>   \#lang rash
>   [cd](#%28form._%28%28lib._rash%2Fmain..rkt%29._cd%29%29) project-directory
>   echo The [number](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=syntax&rel=Library_Syntax_Classes_and_Literal_Sets.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._number%2529%2529&version=8.4) of Racket files in this directory:
>   ls \*.rkt [\|](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E7c%2529%2529&version=8.4) wc -l
>   ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

You can use Racket functions in pipelines.

> > > Note that [port-\>string](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=port-lib.html%23%2528def._%2528%2528lib._racket%252Fport..rkt%2529._port-%7E3estring%2529%2529&version=8.4) is part of the racket/port library, thus one must ([require](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&version=8.4) racket/port) before using it.

Pipelines pass objects. When a process pipeline segment is next to a function pipeline segment, it passes a port to the function segment. When a function segment is followed by a process segment, the return value of the function segment is printed to the stdin of the process.

The \|\>\> operator is like the \|\> operator except that if it receives a port it converts it to a string automatically. So the above example can be simplified as:

You can also make pipelines composed entirely of Racket functions.

Pipelines always start with an operator, and if none is specified the default-pipeline-starter is inserted. Pipeline operators are user-definable with [define-pipeline-operator](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._define-pipeline-operator%2529%2529&version=8.4). Defining new operators can help make common patterns shorter, simpler, and flatter. For instance the =map= operator wraps the [map](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=pairs.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmap..rkt%2529._map%2529%2529&version=8.4) function, allowing you to specify just the body of a lambda.

>   -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
>   ;; =map= is in the demo file still,
>   ;; in the rash-demos package
>   ([require](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&version=8.4) rash/demo/setup)
>   ;; These two are the same.
>   [\|\>](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E7c%7E3e%2529%2529&version=8.4) [list](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&version=8.4) 1 2 3 [\|\>](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E7c%7E3e%2529%2529&version=8.4) [map](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=pairs.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmap..rkt%2529._map%2529%2529&version=8.4) ([λ](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=lambda.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._%7Ece%7Ebb%2529%2529&version=8.4) (x) ([+](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252B%2529%2529&version=8.4) 2 x))
>   [\|\>](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E7c%7E3e%2529%2529&version=8.4) [list](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&version=8.4) 1 2 3 =map= [+](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252B%2529%2529&version=8.4) 2
>   -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Pipeline operators are macros, and therefore can play any of the tricks that macros generally can in Racket. The \| operator can auto-quote symbols, turn asterisks into [glob](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=file&rel=glob.html%23%2528def._%2528%2528lib._file%252Fglob..rkt%2529._glob%2529%2529&version=8.4) expansion code, etc. The \|\> operator can detect whether the [current-pipeline-argument](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._current-pipeline-argument%2529%2529&version=8.4) is used and insert it automatically.

If you put parentheses in the middle of a pipeline, you escape to normal Racket code.

>   ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
>   ;; This will either show hidden files or give a long listing
>   ls ([if](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=if.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._if%2529%2529&version=8.4) ([even?](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._even%7E3f%2529%2529&version=8.4) ([random](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=generic-numbers.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._random%2529%2529&version=8.4) 2)) [\'](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&version=8.4)-l [\'](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&version=8.4)-a)
>   ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Lines of code in Rash are command pipelines by default, but there are key words called line-macros that can change the behavior arbitrarily.

> > > Line-macros can be used to make C-like control-flow forms like for, try/catch, etc, to make one-off non-pipeline forms like [cd](#%28form._%28%28lib._rash%2Fmain..rkt%29._cd%29%29), or even to make entirely new and different line-oriented languages.

>   ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
>   ;; in-dir is in the demo file still
>   ([require](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&version=8.4) rash/demo/setup)
>   in-dir \$HOME/project {
>     make clean
>   }
>   ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

For instance, in-dir executes code with [current-directory](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=Filesystem.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._current-directory%2529%2529&version=8.4) parameterized based on its first argument. Note that logical rash lines don't necessarily line-up with physical lines. Newlines can be escaped with a backslash, commented out with multiline comments, and if they are inside parentheses or braces they are handled by the recursive read.

Braces trigger a recursive line-mode read. They are available in line-mode as well as in the embedded s-expression mode. So they can be used to create blocks in line-mode as with the above in-dir example, or be used to escape from the s-expression world to line-mode.

Note that subprocess pipelines are connected to stdout and stdin in the REPL and at the top level of \#lang rash. The most common thing you want when embedding some Rash code is for subprocess output to be converted to a string. Using \#{} switches to line-mode with defaults changed so that subprocess output is converted to a string and passed through string-trim.

>   ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
>   ;; \#%hash-braces is provided by the demo library right now\...
>   ([require](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&version=8.4) rash/demo/setup)
>   ;; I do this a lot when I don\'t remember what a script does
>   cat \#{which my-script.rkt}
>   ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

TODO - how to more generally parameterize such settings.

Every line in Rash is actually a line-macro. If a line does not start with a line-macro name explicitly, [\#%linea-default-line-macro](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=linea&rel=index.html%23%2528form._%2528%2528lib._linea%252Fdefaults..rkt%2529._%7E23%7E25linea-default-line-macro%2529%2529&version=8.4) is inserted. By default this is [run-pipeline](#%28form._%28%28lib._rash%2Fmain..rkt%29._run-pipeline%29%29) in Rash.

TODO - actually the default is run-pipeline/logic, which I haven't documented yet, which adds && and \|\|.

You can also write normal parenthesized Racket code. If the first (non-whitespace) character on a line is an open parenthesis, the line is read as normal Racket code and no line-macro is inserted.

Note that practically all Racket code starts with an open-paren, so Rash is almost a superset of normal Racket. The only thing lost is top-level non-parenthesized code, which is really only useful to see the value of a variable. Most programs in \#lang racket/base could be switched to \#lang rash and still function identically, and I never launch the Racket repl anymore because rash-repl is both a shell and a full Racket repl.

>   ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
>   ([define](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&version=8.4) x 1234)
>   ;; Now let\'s see the value of x.
>   ;; We can\'t just write \`x\`, but we can do any of these:
>   ([values](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=values.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._values%2529%2529&version=8.4) x)
>   [\|\>](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E7c%7E3e%2529%2529&version=8.4) [values](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=values.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._values%2529%2529&version=8.4) x
>   echo \$x
>   ([require](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&version=8.4) rash/demo/setup)
>   val x
>   ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Avoiding line-macros by starting with a paren causes an annoying inconsistency -- you can't have a line-macro auto-inserted if the first argument to the line macro is a parenthesized form.

>   ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
>   ;; We want to choose a compiler at runtime.
>   [run-pipeline](#%28form._%28%28lib._rash%2Fmain..rkt%29._run-pipeline%29%29) ([if](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=if.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._if%2529%2529&version=8.4) use-clang? [\'](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&version=8.4)clang [\'](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&version=8.4)gcc) -o prog prog.c
>   ;; If we leave off the line-macro name, it will not be inserted
>   ;; because the line starts with a parenthesis.
>   ;; This will probably cause an error!
>   ([if](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=if.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._if%2529%2529&version=8.4) use-clang? [\'](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&version=8.4)clang [\'](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&version=8.4)gcc) -o prog prog.c
>   ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

This problem can be fixed by prepending the line-macro name or by using \[square\] brackets instead of parentheses. The issue doesn't come up much in practice, and it's a small sacrifice for the convenience of having both normal Racket s-expressions and Rash lines.

Rash is primarily a combination of two libraries --
[Linea: line oriented reader](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=linea&rel=index.html&version=8.4),
which will explain the details of the line-oriented concrete syntax, and the
[Pipeline Macro Library](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html&version=8.4),
which will explain the details of the [run-pipeline](#%28form._%28%28lib._rash%2Fmain..rkt%29._run-pipeline%29%29) macro and pipeline operators.
You should read their documentation as well if you want a more thorough understanding of Rash.

What else belongs in a quick overview? Pipelines with failure codes don't fail silently -- they raise exceptions. More fine-grained behavior can be configured per-pipeline, or using aliases (eg. whether other exit codes besides 0 are successful, whether to check for success in subprocesses in the middle of a pipeline, etc). There are probably more things I should say. But probably the best way forward from here is to read the [run-pipeline](#%28form._%28%28lib._rash%2Fmain..rkt%29._run-pipeline%29%29) macro documentation.

You can define aliases with [define-pipeline-alias](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._define-pipeline-alias%2529%2529&version=8.4) or [define-simple-pipeline-alias](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._define-simple-pipeline-alias%2529%2529&version=8.4). Aliases are currently supported only by [=unix-pipe=](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E3dunix-pipe%7E3d%2529%2529&version=8.4), though I may change that. Aliases basically bypass the pipe itself -- basically so you can have [=unix-pipe=](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E3dunix-pipe%7E3d%2529%2529&version=8.4) be the default operator but have a set of key-words that bypass it for a different operator without having to write the operator when it's in starting position. And to be able to define aliases that are a little more familiar to people.

You can access environment variables with [getenv](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=envvars.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._getenv%2529%2529&version=8.4) and [putenv](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=envvars.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._putenv%2529%2529&version=8.4), or by accessing the [current-environment-variables](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=envvars.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._current-environment-variables%2529%2529&version=8.4) parameter. Individual pipelines should have some sugar to set environment variables more conveniently, but I haven't added that yet. Also, the dollar escapes done by [=unix-pipe=](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E3dunix-pipe%7E3d%2529%2529&version=8.4) access environment variables instead of normal lexical variables if you use a variable name in ALL CAPS.

Also, for those who just want to pipeline subprocesses in a Racket program using a lispy syntax, you probably want the shell/pipeline library, a basic component of Rash that can be used on its own:
[Basic Unix-style Pipelines](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline.html&version=8.4)

While you can use Rash as a \#lang, you can also just use the bindings it exports via ([require](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&version=8.4) [rash](#%28form._%28%28lib._rash%2Fmain..rkt%29._rash%29%29)). Note that requiring the rash module will not affect the reader, so the line-oriented syntax will not be available unless you take steps to use it too (IE use the Linea reader, or use the [rash](#%28form._%28%28lib._rash%2Fmain..rkt%29._rash%29%29) macro).

Here are some miscellaneous little sections I am adding off-the-cuff based on discussions until I rewrite the whole Rash Guide to be better.

#### 2.1` `[]{#(part._quoting_globs)}quoting globs

How do you stop globs and dollars from expanding without putting them in parenthesized forms? Quote them.

>   ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
>   ;; print \"\*.rkt\" literally
>   echo [\'](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&version=8.4)\*.rkt
>    
>   ;; print \"\$HOME\" literally
>   echo [\'](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._quote%2529%2529&version=8.4)\"\$HOME\"
>   ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Globs desugar to a use of the [glob](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=file&rel=glob.html%23%2528def._%2528%2528lib._file%252Fglob..rkt%2529._glob%2529%2529&version=8.4) function.

TODO - I need a better documentation section on globbing generally.

#### 2.2` `[]{#(part._.Rash_s_names_are_terrible__how_do_.I_rename_them_)}Rash's names are terrible, how do I rename them?

Line macros (like [cd](#%28form._%28%28lib._rash%2Fmain..rkt%29._cd%29%29)), pipeline operators (like [\\\|\>](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E7c%7E3e%2529%2529&version=8.4)), and pipeline option flags (like [&\>](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E26%7E3e%2529%2529&version=8.4) and [&bg](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E26bg%2529%2529&version=8.4)) are all macros, so you can rename them with [make-rename-transformer](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=stxtrans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._make-rename-transformer%2529%2529&version=8.4):

> ([define-syntax](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define-syntax%2529%2529&version=8.4) [\>](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%7E3e%2529%2529&version=8.4) ([make-rename-transformer](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=stxtrans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._make-rename-transformer%2529%2529&version=8.4) \#\'[&\>!](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E26%7E3e%2521%2529%2529&version=8.4)))

#### 2.3` `[]{#(part._.How_does_the_underscore_work_)}How does the underscore work?

The [\_](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529.__%2529%2529&version=8.4) identifier is short for [current-pipeline-argument](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._current-pipeline-argument%2529%2529&version=8.4).
It is actually a syntax parameter that pipeline operators can make mean whatever they want. So there isn't one single thing that it means. But there is a convention.

Probably the best way to explain [\_](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529.__%2529%2529&version=8.4) is to start with the most basic
pipeline operator that uses it, which is called
[=basic-object-pipe/expression=](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E3dbasic-object-pipe%252Fexpression%7E3d%2529%2529&version=8.4).
The name is terrible, and it should probably have a short name like [\\\|](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E7c%2529%2529&version=8.4) and [\\\|\>](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E7c%7E3e%2529%2529&version=8.4) do. But I haven't decided what yet. Suggestions appreciated.

For now let's call it =bop/e=.

=bop/e= takes an expression that (probably) contains [\_](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529.__%2529%2529&version=8.4). And it uses
it as the body of a function where [\_](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529.__%2529%2529&version=8.4) is the argument. Unless it is in
the first part of the pipeline, in which case [\_](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529.__%2529%2529&version=8.4) is an error.
Actually, it's not a bad operator in start position -- it is like
cat for racket values.

So:

> =bop/e= 5 =bop/e= ([+](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252B%2529%2529&version=8.4) 6 [\_](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529.__%2529%2529&version=8.4))

is like

[=basic-object-pipe=](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E3dbasic-object-pipe%7E3d%2529%2529&version=8.4), or [\\\|\>](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E7c%7E3e%2529%2529&version=8.4), basically unwraps a layer of parentheses
and lets [\_](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529.__%2529%2529&version=8.4) be implicit when it is at the end of the pipeline. So the
following two pipelines are the same as the above.

But you can also explicitly place the underscore elsewhere.

Then [=object-pipe=](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E3dobject-pipe%7E3d%2529%2529&version=8.4) (or [\\\|\>\>](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E7c%7E3e%7E3e%2529%2529&version=8.4)) is the same, except that it automatically detects ports and turns them into strings.

Other operators like =map= and =filter= place [\_](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529.__%2529%2529&version=8.4) like [\\\|\>](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E7c%7E3e%2529%2529&version=8.4) does, but instead of standing for the whole object received from the previous pipeline stage, it stands for an element of the object received (which must be a list).

### 3` `[]{#(part._.Media)}Media

A preprint of an academic paper about Rash is available [here](http://willghatch.net/publications/rash-gpce-2018-preprint.pdf).
It is much better documentation than the Rash guide, currently.

I made a quick demo recording of an interactive repl that is on [the project website](https://rash-lang.org/).

Also I gave a talk at RacketCon 2017 about it, which can be viewed
[here](https://www.youtube.com/watch?v=yXcwK3XNU3Y&index=13&list=PLXr4KViVC0qIgkwFFzM-0we_aoOfAl16Y), though it is outdated.
There have been various changes since the talk was given, but the core ideas are the same. The biggest change since then is that embedding the line-syntax is encouraged with braces in the Linea syntax rather than string embedding.

### 4` `[]{#(part._.Rash_.Reference)}Rash Reference

#### 4.1` `[]{#(part._shell-pipeline_re-exports)}shell-pipeline re-exports

Note that all the pipeline things ([run-pipeline](#%28form._%28%28lib._rash%2Fmain..rkt%29._run-pipeline%29%29),
[=unix-pipe=](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E3dunix-pipe%7E3d%2529%2529&version=8.4), [=object-pipe=](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E3dobject-pipe%7E3d%2529%2529&version=8.4),
[define-pipeline-operator](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._define-pipeline-operator%2529%2529&version=8.4), etc) are documented in the
[Pipeline Macro Library](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html&version=8.4)
module.

But since those functions/macros are essential to using Rash, I'll also list them here:

Pipeline operators:

-   [=composite-pipe=](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E3dcomposite-pipe%7E3d%2529%2529&version=8.4)

-   [=basic-unix-pipe=](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E3dbasic-unix-pipe%7E3d%2529%2529&version=8.4)

-   [=unix-pipe=](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E3dunix-pipe%7E3d%2529%2529&version=8.4)

-   [\\\|](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E7c%2529%2529&version=8.4)

-   [=basic-object-pipe/expression=](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E3dbasic-object-pipe%252Fexpression%7E3d%2529%2529&version=8.4)

-   [=basic-object-pipe/form=](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E3dbasic-object-pipe%252Fform%7E3d%2529%2529&version=8.4)

-   [=basic-object-pipe=](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E3dbasic-object-pipe%7E3d%2529%2529&version=8.4)

-   [\\\|\>](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E7c%7E3e%2529%2529&version=8.4)

-   [=object-pipe/expression=](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E3dobject-pipe%252Fexpression%7E3d%2529%2529&version=8.4)

-   [=object-pipe/form=](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E3dobject-pipe%252Fform%7E3d%2529%2529&version=8.4)

-   [=object-pipe=](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E3dobject-pipe%7E3d%2529%2529&version=8.4)

-   [\\\|\>\>](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E7c%7E3e%7E3e%2529%2529&version=8.4)

-   default-pipeline-starter

Defining pipeline operators:

-   [define-pipeline-operator](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._define-pipeline-operator%2529%2529&version=8.4)

-   [define-pipeline-alias](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._define-pipeline-alias%2529%2529&version=8.4)

-   [define-simple-pipeline-alias](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._define-simple-pipeline-alias%2529%2529&version=8.4)

-   [current-pipeline-argument](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._current-pipeline-argument%2529%2529&version=8.4)

-   [\_](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529.__%2529%2529&version=8.4)

-   [expand-pipeline-arguments](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._expand-pipeline-arguments%2529%2529&version=8.4)

Pipeline flags:

-   [&bg](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E26bg%2529%2529&version=8.4)

-   [&pipeline-ret](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E26pipeline-ret%2529%2529&version=8.4)

-   [&in](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E26in%2529%2529&version=8.4)

-   [&\<](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E26%7E3c%2529%2529&version=8.4)

-   [&out](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E26out%2529%2529&version=8.4)

-   [&\>](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E26%7E3e%2529%2529&version=8.4)

-   [&\>!](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E26%7E3e%2521%2529%2529&version=8.4)

-   [&\>\>](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E26%7E3e%7E3e%2529%2529&version=8.4)

-   [&err](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E26err%2529%2529&version=8.4)

-   [&strict](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E26strict%2529%2529&version=8.4)

-   [&permissive](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E26permissive%2529%2529&version=8.4)

-   [&lazy](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E26lazy%2529%2529&version=8.4)

-   [&lazy-timeout](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E26lazy-timeout%2529%2529&version=8.4)

Pipeline implicit option configuration (note that these are subsumed by [with-rash-config](#%28form._%28%28lib._rash%2Fmain..rkt%29._with-rash-config%29%29)):

-   [with-pipeline-config](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._with-pipeline-config%2529%2529&version=8.4)

-   [splicing-with-pipeline-config](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._splicing-with-pipeline-config%2529%2529&version=8.4)

#### 4.2` `[]{#(part._linea_re-exports)}linea re-exports

All the things about reading and line-macros ([define-line-macro](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=linea&rel=index.html%23%2528form._%2528%2528lib._linea%252Fline-macro..rkt%2529._define-line-macro%2529%2529&version=8.4), [\#%linea-line](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=linea&rel=index.html%23%2528form._%2528%2528lib._linea%252Fdefaults..rkt%2529._%7E23%7E25linea-line%2529%2529&version=8.4), etc) are documented in the
[Linea: line oriented reader](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=linea&rel=index.html&version=8.4)
module.

But here is an export list, so it's visible in this page:

From linea/defaults:

-   [\#%linea-expressions-begin](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=linea&rel=index.html%23%2528form._%2528%2528lib._linea%252Fdefaults..rkt%2529._%7E23%7E25linea-expressions-begin%2529%2529&version=8.4)

-   [\#%linea-line](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=linea&rel=index.html%23%2528form._%2528%2528lib._linea%252Fdefaults..rkt%2529._%7E23%7E25linea-line%2529%2529&version=8.4)

-   [\#%linea-s-exp](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=linea&rel=index.html%23%2528form._%2528%2528lib._linea%252Fdefaults..rkt%2529._%7E23%7E25linea-s-exp%2529%2529&version=8.4)

-   [\#%linea-default-line-macro](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=linea&rel=index.html%23%2528form._%2528%2528lib._linea%252Fdefaults..rkt%2529._%7E23%7E25linea-default-line-macro%2529%2529&version=8.4)

From linea/line-macro (note that with-default-line-macro is subsumed by with-rash-config):

-   [define-line-macro](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=linea&rel=index.html%23%2528form._%2528%2528lib._linea%252Fline-macro..rkt%2529._define-line-macro%2529%2529&version=8.4)

-   default-line-macro

-   [with-default-line-macro](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=linea&rel=index.html%23%2528form._%2528%2528lib._linea%252Fline-macro..rkt%2529._with-default-line-macro%2529%2529&version=8.4)

-   [splicing-with-default-line-macro](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=linea&rel=index.html%23%2528form._%2528%2528lib._linea%252Fline-macro..rkt%2529._splicing-with-default-line-macro%2529%2529&version=8.4)

#### 4.3` `[]{#(part._.Rash_original_exports)}Rash original exports

TODO: document forms for configuring Rash besides the rash macro, document forms for creating customized versions of \#lang rash (including reader modifications, default line-macro and pipeline operator, bindings available\...), etc

> > ([]{#(form._((lib._rash/main..rkt)._with-rash-config))}[with-rash-config](#%28form._%28%28lib._rash%2Fmain..rkt%29._with-rash-config%29%29) options \... body)

Configures the defaults for various options, and runs the body.

Options:

\#:out sets the default output port or transformer for unix pipelines (as run by [run-pipeline](#%28form._%28%28lib._rash%2Fmain..rkt%29._run-pipeline%29%29)). The default runs [port-\>string](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=port-lib.html%23%2528def._%2528%2528lib._racket%252Fport..rkt%2529._port-%7E3estring%2529%2529&version=8.4) on the output. Note that a custom output transformer should close the received port!

\#:in sets the default input port for unix pipelines (as run by [run-pipeline](#%28form._%28%28lib._rash%2Fmain..rkt%29._run-pipeline%29%29)). The default is an empty port.

\#:err sets the default error port for unix pipelines (as run by [run-pipeline](#%28form._%28%28lib._rash%2Fmain..rkt%29._run-pipeline%29%29)). The default is to turn the errors into a string that is put into the exception generated by an error in the pipeline.

\#:starter sets the default starting pipeline operator for [run-pipeline](#%28form._%28%28lib._rash%2Fmain..rkt%29._run-pipeline%29%29) when one is not explicitly given in the pipeline. The default is [=unix-pipe=](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529._%7E3dunix-pipe%7E3d%2529%2529&version=8.4).

\#:line-macro sets the default line-macro for lines that don't explicitly have one. The default is the [run-pipeline](#%28form._%28%28lib._rash%2Fmain..rkt%29._run-pipeline%29%29) line-macro.

Note that in, out, and err are evaluated once for each pipeline run in the body.

> > ([]{#(form._((lib._rash/main..rkt)._splicing-with-rash-config))}[splicing-with-rash-config](#%28form._%28%28lib._rash%2Fmain..rkt%29._splicing-with-rash-config%29%29) options \... body)

> > ([]{#(form._((lib._rash/main..rkt)._rash))}[rash](#%28form._%28%28lib._rash%2Fmain..rkt%29._rash%29%29) options \... codestring)

Read codestring as rash code. Note that this happens during macro expansion, not at runtime. This is useful to switch to Rash code in a module that uses a different reader.

Options:

The options are the same as [with-rash-config](#%28form._%28%28lib._rash%2Fmain..rkt%29._with-rash-config%29%29).

TODO - options for changing the reader, etc.

Note that the input/output/error-output have different defaults for the rash macro than for the \#lang or repl.

Unstable.
I don't want to commit to this, yet.

> > ([]{#(form._((lib._rash/main..rkt)._make-rash-transformer))}[make-rash-transformer](#%28form._%28%28lib._rash%2Fmain..rkt%29._make-rash-transformer%29%29) options \...)

This takes all the same options as [rash](#%28form._%28%28lib._rash%2Fmain..rkt%29._rash%29%29), but doesn't take a code string. It produces a transformer like [rash](#%28form._%28%28lib._rash%2Fmain..rkt%29._rash%29%29), but with different default values for the available options.

Note that the expressions given for default input/output/error ports are evaluated for each pipeline, and so should either be function applications that produce consistent ports (eg. [current-input-port](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=port-ops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._current-input-port%2529%2529&version=8.4)) or some expression that gives a fresh port that you want each time.

Unstable.
I don't want to commit to this, yet.

Note that the default \#lang rash has its input/output/error-output as stdin/stdout/stderr, which is different than the rash macro.

Change [current-directory](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=Filesystem.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._current-directory%2529%2529&version=8.4) to given directory. The directory is quoted, so just put a literal path or a string.

If no argument is given, it changes to the user's home directory.

Unstable.
The current version does dollar and tilde expansion, and the way that works may change in the future.
Additionally, I may add support for things like cd - a la bash and friends, as well as more general directiory history tracking. But I'm not really sure yet.
But basic cd my-directory type stuff will definitely keep working the same.

Determines how expressions at the top of \#lang rash modules (IE forms that aren't definitions) and expressions in the Rash REPL are printed. Note that it doesn't actually do the printing -- it returns a string, which is then printed by the implicit printing wraps at the top of a module or (probably) by the current-prompt-function.

The default takes the result out of terminated pipelines to print rather than the pipeline object itself. I plan to change the default. But the idea of having this parameter is that you can set up your repl to print things in a more useful way, and then have it print the same way in a \#lang rash script.

Unstable: the way things are printed may change.

### 5` `[]{#(part._.Interactive_.Use)}Interactive Use

You can run the repl by running racket -l rash/repl. An executable named rash-repl is installed in Racket's bin directory, so if you have it on your path you can run rash-repl instead.

Unstable:
Various details of the repl will change over time.
But that basically just means the repl will get cooler over time.
The biggest change to come is that at some point the line-editor will be swapped out.

Note that in the repl the default input/output/error-output are to the stdin/out/err connected to the terminal unless you change them. This is different than the rash macro, and allows you to do things like run curses programs that have access to terminal ports.

The repl can be customized with rc files.
First, if \$HOME/.config/rash/rashrc.rkt exists, it is required at the top level of the REPL. Then, if \$HOME/.config/rash/rashrc (note the lack of .rkt) exists, it is evaluated at the top level more or less as if typed in (much like rc files for bash and friends). Note that rashrc.rkt files are modules, can be in any \#lang, and get all the normal and good compilation guarantees that Racket modules enjoy. rashrc is NOT a module, and gets none of them. rashrc is mainly there to let you muck up the namespace that you use interactively. Prefer rashrc.rkt.

Actually, the rc files are found using [list-config-files](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=basedir&rel=index.html%23%2528def._%2528%2528lib._basedir%252Fmain..rkt%2529._list-config-files%2529%2529&version=8.4). You can read its docs for specifics, but the gist is that it depends on the value of the XDG\_CONFIG\_HOME and XDG\_CONFIG\_DIRS environment variables. \$HOME/.config/rash/rashrc is the default on Unix, while the default is %LOCALAPPDATA%/rash/rashrc on Windows.

Note that "the top-level is hopeless". This applies to the Rash REPL as well as rashrc files. But the hopelessness is mostly to do with defining macros, particularly complicated macros such as mutually recursive or macro-defining macros. So the hopelessness doesn't affect the types of things most people are likely to do in a shell. But if you don't remember that, you might put "hopeless" things in a rashrc file. Don't. Put it in a module like rashrc.rkt (or any other module or library you make). (For more hopelessness, see [this](https://gist.github.com/samth/3083053).)

A few nice things (like stderr highlighting) are in a demo-rc file you can require. To do so, add this to \$HOME/.config/rash/rashrc:

(require rash/demo/demo-rc)

(Rash actually follows the XDG basedir standard -- you can have rashrc.rkt or rashrc files in any directory of \$XDG\_CONFIG\_HOME or \$XDG\_CONFIG\_DIRS, and the rash repl will load all of them)

#### 5.1` `[]{#(part._.Unicode_and_garbled_glyphs)}Unicode and garbled glyphs

The repl uses the readline module for line-editing and completion. The readline module by default uses libedit instead of the actual libreadline for licensing reasons. Libedit doesn't seem to handle unicode properly. Installing the readline-gpl package fixes that (raco pkg install readline-gpl). Note that the readline-gpl Racket package needs a libreadline shared library to be installed on your system, so you may need to install a libreadline package using your system package manager. For example, on Debian-based distributions you can install by running sudo apt install --yes libreadline-dev.

#### 5.2` `[]{#(part._.Interactive_functions__unstable_)}Interactive functions (unstable)

All the following repl functions are not stable.

Only available in the repl. Return the result of the nth interactive command.
Unstable.

> > ([]{#(form._((lib._rash/main..rkt)._set-default-pipeline-starter!))}set-default-pipeline-starter! new-starter)

Only available in the repl.
A line-macro that mutates the default pipeline starter used in the repl.
It's not really hygienic, so if you defined macros that used [run-pipeline](#%28form._%28%28lib._rash%2Fmain..rkt%29._run-pipeline%29%29) without an explicit starter, this will change the result of new calls to that macro.
Basically a hack to be able to set it since I haven't figured out a better way to do it yet, aside from maybe having people make their own repl modules that set some defaults, and I'm not sure I like that plan.
Expect this to change eventually.

Unstable.

> > ([]{#(form._((lib._rash/main..rkt)._set-default-line-macro!))}set-default-line-macro! new-line-macro)

Only available in the repl.
A line-macro that mutates the default line macro used in the repl.
It's not really hygienic.
Basically a hack to be able to set it since I haven't figured out a better way to do it yet, aside from maybe having people make their own repl modules that set some defaults, and I'm not sure I like that plan.
Expect this to change eventually.

Unstable.

You can set this parameter to change the prompt. The prompt is responsible for printing the result returned by whatever was last run as well as showing any information you want to see. Right now I would just stick with the default, but I plan on making a nice library of useful functions to put in a prompt (eg. functions for displaying git information, path information with length pruning, \...), and have a way of easily connecting some prompt pieces to make something good (including a way to customize how results are displayed -- I want to, for example, have types of objects that can be recognized to print tables nicely, etc).

The given function's arity is tested to see if it receives various keywords, so that the protocol can be extended and the user only has to specify the keywords that are needed for a given prompt.

Keywords optionally given:

\#:last-return-value - fairly self explanatory. If multiple values were returned, they will be given as a list. This will be ([void](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%2529%2529&version=8.4)) for the prompt before the first command. The default prompt function formats the return value with [current-rash-top-level-print-formatter](#%28def._%28%28lib._rash%2Fmain..rkt%29._current-rash-top-level-print-formatter%29%29) before printing it.

\#:last-return-index - This increments once for every command run in the repl. It will be 0 for the prompt before the first command. This is the index that can be used for result-n. The default prompt function prints the number of the result before printing the result itself.

Unstable. I may change how this works. But probably it actually is stable, I just don't want to commit to it yet, especially given that the entire line editor will eventually change.

Example:

>   -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
>   ([define](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&version=8.4) (a-prompt \#:last-return-value \[last-ret \#f\])
>     ([printf](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._printf%2529%2529&version=8.4) \"\~v \>\" last-ret))
>   (current-prompt-function a-prompt)
>   -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Note that when readline is active, you probably want to use the function readline-prompt in the prompt function, because the readline library itself wants to print something. Eg.

>   -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
>   ([require](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&version=8.4) readline/pread)
>   ([define](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&version=8.4) (a-prompt \#:last-return-value \[last-ret \#f\])
>     ([printf](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._printf%2529%2529&version=8.4) \"\~v \" last-ret)
>     (readline-prompt \#\"\>\"))
>   (current-prompt-function a-prompt)
>   -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

### 6` `[]{#(part._.Prompt_helpers)}Prompt helpers

There are currently a few functions that can help you design a custom prompt. Currently, they support things like changing foreground/background color and underlined text and getting git information, and they will be expanded in the future to include more useful ways of getting information for your prompt.

Unstable.

#### 6.1` `[]{#(part._.Styling_.Strings)}Styling Strings

These are some usefull functions for styling strings.

You can use them with (require rash/prompt-helpers/string-style)

> <table>
> <colgroup>
> <col style="width: 100%" />
> </colgroup>
> <tbody>
> <tr class="odd">
> <td><blockquote>
> <table>
> <tbody>
> <tr class="odd">
> <td>(<span id="(def._((lib._rash/prompt-helpers/string-style..rkt)._create-styled-string))"></span><a href="#%28def._%28%28lib._rash%2Fprompt-helpers%2Fstring-style..rkt%29._create-styled-string%29%29">create-styled-string</a></td>
> <td> [</td>
> <td>to-style</td>
> <td> </td>
> </tr>
> <tr class="even">
> <td> </td>
> <td> </td>
> <td>#:fg foreground</td>
> <td> </td>
> </tr>
> <tr class="odd">
> <td> </td>
> <td> </td>
> <td>#:bg background</td>
> <td> </td>
> </tr>
> <tr class="even">
> <td> </td>
> <td> </td>
> <td>#:bold? bold?</td>
> <td> </td>
> </tr>
> <tr class="odd">
> <td> </td>
> <td> </td>
> <td>#:italic? italic?</td>
> <td> </td>
> </tr>
> <tr class="even">
> <td> </td>
> <td> </td>
> <td>#:underlined? underlined?</td>
> <td> </td>
> </tr>
> <tr class="odd">
> <td> </td>
> <td> </td>
> <td>#:reset-before? reset-before?</td>
> <td> </td>
> </tr>
> <tr class="even">
> <td> </td>
> <td> </td>
> <td>#:reset-after? reset-after?</td>
> <td> </td>
> </tr>
> <tr class="odd">
> <td> </td>
> <td> </td>
> <td>#:custom-commands custom-commands</td>
> <td> </td>
> </tr>
> <tr class="even">
> <td> </td>
> <td> </td>
> <td>#:create-function? create-function?])</td>
> <td> </td>
> </tr>
> </tbody>
> </table>
> </blockquote></td>
> </tr>
> <tr class="even">
> <td> → (<a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=8.4">or/c</a> <a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string%7E3f%2529%2529&amp;version=8.4">string?</a> (<a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=8.4">-&gt;</a> <a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string%7E3f%2529%2529&amp;version=8.4">string?</a> <a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string%7E3f%2529%2529&amp;version=8.4">string?</a>))</td>
> </tr>
> <tr class="odd">
> <td>  to-style : <a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string%7E3f%2529%2529&amp;version=8.4">string?</a> = ""</td>
> </tr>
> <tr class="even">
> <td>  foreground : (<a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=8.4">or/c</a> <a href="#%28def._%28%28lib._rash%2Fprompt-helpers%2Fstring-style..rkt%29._color-value~3f%29%29">color-value?</a> #f) = #f</td>
> </tr>
> <tr class="odd">
> <td>  background : (<a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=8.4">or/c</a> <a href="#%28def._%28%28lib._rash%2Fprompt-helpers%2Fstring-style..rkt%29._color-value~3f%29%29">color-value?</a> #f) = #f</td>
> </tr>
> <tr class="even">
> <td>  bold? : <a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=8.4">boolean?</a> = #f</td>
> </tr>
> <tr class="odd">
> <td>  italic? : <a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=8.4">boolean?</a> = #f</td>
> </tr>
> <tr class="even">
> <td>  underlined? : <a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=8.4">boolean?</a> = #f</td>
> </tr>
> <tr class="odd">
> <td>  reset-before? : <a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=8.4">boolean?</a> = #t</td>
> </tr>
> <tr class="even">
> <td>  reset-after? : <a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=8.4">boolean?</a> = #t</td>
> </tr>
> <tr class="odd">
> <td>  custom-commands : <a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string%7E3f%2529%2529&amp;version=8.4">string?</a> = ""</td>
> </tr>
> <tr class="even">
> <td>  create-function? : <a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=8.4">boolean?</a> = #f</td>
> </tr>
> </tbody>
> </table>

Produces a string with the specified styles.

The values given for foreground and background are treated the same. If a string is given, it must either be the name of a 4 bit color, e.g. \"red\" or \"bright red\" for the high-intensity version, or start with the charachter \"\#\" and represent a hexidecimal color code, e.g. \"\#f2e455\" or \"\#fff\". If a number is given, it is treated as a color code for a 8bit/256color color. If a list is given, it is treated as an RGB value for a color, e.g. \'(0 0 0) means black. An object with red, green, and blue methods (like color%) can also be given, and are treated like RGB values. See [this](https://stackoverflow.com/a/33206814/4530731) stack overflow answer for more information on ansi colors.

The values bold?, italic?, and underlined? do what you'd expect them to.

If reset-before? is \#t, then the ANSI escape sequence \"\\033\[0m\" will be added to the front of the string. When [display](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._display%2529%2529&version=8.4)ed, it has the effect of clearing all styles set by ANSI escape sequences before itself. Similarily, if reset-after? is \#t, the sequence \"\\033\[0m\" is appended to the end of the string.

The string custom-commands is placed right before to-style, so any styles in the form of ANSI escape sequences can be added overridden if desired.

If create-function? is \#t, then a function is returned instead of a string. This function takes 1 argument and places that argument where to-style would have went, and returns the resulting string.

> > > I cant display the actual colors here, but you can copy the resulting strings into a terminal and print them with echo \"string\" or display them using [display](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._display%2529%2529&version=8.4) in a terminal window.

Examples:

> <table>
> <colgroup>
> <col style="width: 100%" />
> </colgroup>
> <tbody>
> <tr class="odd">
> <td><table>
> <tbody>
> <tr class="odd">
> <td>&gt; (<a href="#%28def._%28%28lib._rash%2Fprompt-helpers%2Fstring-style..rkt%29._create-styled-string%29%29">create-styled-string</a> "example"</td>
> </tr>
> <tr class="even">
> <td>                        #:bg "red"</td>
> </tr>
> <tr class="odd">
> <td>                        #:fg '(255 255 255)</td>
> </tr>
> <tr class="even">
> <td>                        #:underlined? #t)</td>
> </tr>
> </tbody>
> </table></td>
> </tr>
> <tr class="even">
> <td><p>"\e[0m\e[38;2;255;255;255m\e[41m\e[4mexample\e[0m"</p></td>
> </tr>
> <tr class="odd">
> <td><table>
> <tbody>
> <tr class="odd">
> <td>&gt; (<a href="#%28def._%28%28lib._rash%2Fprompt-helpers%2Fstring-style..rkt%29._create-styled-string%29%29">create-styled-string</a> "example"</td>
> </tr>
> <tr class="even">
> <td>                        #:bg "red"</td>
> </tr>
> <tr class="odd">
> <td>                        #:fg '(255 255 255)</td>
> </tr>
> <tr class="even">
> <td>                        #:underlined? #t</td>
> </tr>
> <tr class="odd">
> <td>                        #:reset-before? #f)</td>
> </tr>
> </tbody>
> </table></td>
> </tr>
> <tr class="even">
> <td><p>"\e[38;2;255;255;255m\e[41m\e[4mexample\e[0m"</p></td>
> </tr>
> <tr class="odd">
> <td><table>
> <tbody>
> <tr class="odd">
> <td>&gt; (<a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.4">define</a> style-function</td>
> </tr>
> <tr class="even">
> <td>    (<a href="#%28def._%28%28lib._rash%2Fprompt-helpers%2Fstring-style..rkt%29._create-styled-string%29%29">create-styled-string</a> #:bg "red"</td>
> </tr>
> <tr class="odd">
> <td>                          #:create-function? #t))</td>
> </tr>
> </tbody>
> </table></td>
> </tr>
> <tr class="even">
> <td>&gt; (style-function "I'm red!")</td>
> </tr>
> <tr class="odd">
> <td><p>"\e[0m\e[41mI'm red!\e[0m"</p></td>
> </tr>
> </tbody>
> </table>

Thoroughly determines whether v is a valid color argument. See [create-styled-string](#%28def._%28%28lib._rash%2Fprompt-helpers%2Fstring-style..rkt%29._create-styled-string%29%29) for valid color arguments.

> <table>
> <colgroup>
> <col style="width: 100%" />
> </colgroup>
> <tbody>
> <tr class="odd">
> <td><blockquote>
> <table>
> <tbody>
> <tr class="odd">
> <td>(<span id="(def._((lib._rash/prompt-helpers/string-style..rkt)._create-styled-struct))"></span><a href="#%28def._%28%28lib._rash%2Fprompt-helpers%2Fstring-style..rkt%29._create-styled-struct%29%29">create-styled-struct</a></td>
> <td> </td>
> <td>to-style</td>
> <td> </td>
> </tr>
> <tr class="even">
> <td> </td>
> <td> </td>
> <td>...</td>
> <td> </td>
> </tr>
> <tr class="odd">
> <td> </td>
> <td> [</td>
> <td>#:fg foreground</td>
> <td> </td>
> </tr>
> <tr class="even">
> <td> </td>
> <td> </td>
> <td>#:bg background</td>
> <td> </td>
> </tr>
> <tr class="odd">
> <td> </td>
> <td> </td>
> <td>#:bold? bold?</td>
> <td> </td>
> </tr>
> <tr class="even">
> <td> </td>
> <td> </td>
> <td>#:italic? italic?</td>
> <td> </td>
> </tr>
> <tr class="odd">
> <td> </td>
> <td> </td>
> <td>#:underlined? underlined?</td>
> <td> </td>
> </tr>
> <tr class="even">
> <td> </td>
> <td> </td>
> <td>#:reset-before? reset-before?</td>
> <td> </td>
> </tr>
> <tr class="odd">
> <td> </td>
> <td> </td>
> <td>#:custom-commands custom-commands]</td>
> <td> </td>
> </tr>
> <tr class="even">
> <td> </td>
> <td> </td>
> <td>#:reset-customs? reset-customs?)</td>
> <td> </td>
> </tr>
> </tbody>
> </table>
> </blockquote></td>
> </tr>
> <tr class="even">
> <td> → styled-struct?</td>
> </tr>
> <tr class="odd">
> <td>  to-style : (<a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=8.4">or/c</a> <a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string%7E3f%2529%2529&amp;version=8.4">string?</a> <a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=structutils.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._struct%7E3f%2529%2529&amp;version=8.4">struct?</a>)</td>
> </tr>
> <tr class="even">
> <td>  foreground : (<a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=8.4">or/c</a> <a href="#%28def._%28%28lib._rash%2Fprompt-helpers%2Fstring-style..rkt%29._color-value~3f%29%29">color-value?</a> default) = default</td>
> </tr>
> <tr class="odd">
> <td>  background : (<a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=8.4">or/c</a> <a href="#%28def._%28%28lib._rash%2Fprompt-helpers%2Fstring-style..rkt%29._color-value~3f%29%29">color-value?</a> default) = default</td>
> </tr>
> <tr class="even">
> <td>  bold? : (<a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=8.4">or/c</a> <a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=8.4">boolean?</a> default) = default</td>
> </tr>
> <tr class="odd">
> <td>  italic? : (<a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=8.4">or/c</a> <a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=8.4">boolean?</a> default) = default</td>
> </tr>
> <tr class="even">
> <td>  underlined? : (<a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=8.4">or/c</a> <a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=8.4">boolean?</a> default) = default</td>
> </tr>
> <tr class="odd">
> <td>  reset-before? : <a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=8.4">boolean?</a> = #f</td>
> </tr>
> <tr class="even">
> <td>  custom-commands : <a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string%7E3f%2529%2529&amp;version=8.4">string?</a> = ""</td>
> </tr>
> <tr class="odd">
> <td>  reset-customs? : #f</td>
> </tr>
> </tbody>
> </table>

Mostly the same as [create-styled-string](#%28def._%28%28lib._rash%2Fprompt-helpers%2Fstring-style..rkt%29._create-styled-string%29%29), except a structure with a list of strings/sub-structs and a style represented by a hash is produced. This struct can be given to [styled-struct-\>string](#%28def._%28%28lib._rash%2Fprompt-helpers%2Fstring-style..rkt%29._styled-struct-~3estring%29%29) to turn it into a string. An uninterned symbol is used as the default value for some of the optional arguments. The function treats the default argument to mean \"use the style the outer struct provides\".

Example:

> <table>
> <colgroup>
> <col style="width: 100%" />
> </colgroup>
> <tbody>
> <tr class="odd">
> <td><table>
> <tbody>
> <tr class="odd">
> <td>&gt; (<a href="#%28def._%28%28lib._rash%2Fprompt-helpers%2Fstring-style..rkt%29._create-styled-struct%29%29">create-styled-struct</a></td>
> </tr>
> <tr class="even">
> <td>   "I'm green. "</td>
> </tr>
> <tr class="odd">
> <td>   (<a href="#%28def._%28%28lib._rash%2Fprompt-helpers%2Fstring-style..rkt%29._create-styled-struct%29%29">create-styled-struct</a> "Im green with red text."</td>
> </tr>
> <tr class="even">
> <td>                         #:fg "red")</td>
> </tr>
> <tr class="odd">
> <td>   #:bg "green")</td>
> </tr>
> </tbody>
> </table></td>
> </tr>
> <tr class="even">
> <td><p>#&lt;styled-struct&gt;</p></td>
> </tr>
> </tbody>
> </table>

> <table>
> <colgroup>
> <col style="width: 100%" />
> </colgroup>
> <tbody>
> <tr class="odd">
> <td><blockquote>
> <p>(<span id="(def._((lib._rash/prompt-helpers/string-style..rkt)._styled-struct-~3estring))"></span><a href="#%28def._%28%28lib._rash%2Fprompt-helpers%2Fstring-style..rkt%29._styled-struct-~3estring%29%29">styled-struct-&gt;string</a> ss [outer-style-hash]) → <a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string%7E3f%2529%2529&amp;version=8.4">string?</a></p>
> </blockquote></td>
> </tr>
> <tr class="even">
> <td>  ss : styled-struct?</td>
> </tr>
> <tr class="odd">
> <td><table style="width:100%;">
> <colgroup>
> <col style="width: 10%" />
> <col style="width: 10%" />
> <col style="width: 10%" />
> <col style="width: 10%" />
> <col style="width: 10%" />
> <col style="width: 10%" />
> <col style="width: 10%" />
> <col style="width: 10%" />
> <col style="width: 10%" />
> <col style="width: 10%" />
> </colgroup>
> <tbody>
> <tr class="odd">
> <td>  </td>
> <td>outer-style-hash</td>
> <td> </td>
> <td>:</td>
> <td> </td>
> <td><a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=hashtables.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._hash%7E3f%2529%2529&amp;version=8.4">hash?</a></td>
> <td> </td>
> <td>=</td>
> <td> </td>
> <td><table>
> <tbody>
> <tr class="odd">
> <td>#hash((foreground . #f)</td>
> </tr>
> <tr class="even">
> <td>      (background . #f)</td>
> </tr>
> <tr class="odd">
> <td>      (bold? . #f)</td>
> </tr>
> <tr class="even">
> <td>      (italic? . #f)</td>
> </tr>
> <tr class="odd">
> <td>      (underlined? . #f)</td>
> </tr>
> <tr class="even">
> <td>      (reset-before? . #t)</td>
> </tr>
> <tr class="odd">
> <td>      (custom-commands . "")</td>
> </tr>
> <tr class="even">
> <td>      (reset-customs? . #t))</td>
> </tr>
> </tbody>
> </table></td>
> </tr>
> </tbody>
> </table></td>
> </tr>
> </tbody>
> </table>

Takes a structure produced by [create-styled-struct](#%28def._%28%28lib._rash%2Fprompt-helpers%2Fstring-style..rkt%29._create-styled-struct%29%29), and recursively produces a string from it. If it finds another struct within ss, it will convert it to a string in it's position in ss, and will use the sub-struct's style properties to override ss's properties if specified.

If reset-before? is \#t for a struct (within its style hash), that struct will ignore the styles provided by an outer struct. If reset-customs? is \#t for a struct, that struct will ignore custom commands given by its outer struct and only use it's own.

Examples (Sorry for the long strings):

> <table>
> <colgroup>
> <col style="width: 100%" />
> </colgroup>
> <tbody>
> <tr class="odd">
> <td><table>
> <tbody>
> <tr class="odd">
> <td>&gt; (<a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.4">define</a> example1</td>
> </tr>
> <tr class="even">
> <td>   (<a href="#%28def._%28%28lib._rash%2Fprompt-helpers%2Fstring-style..rkt%29._styled-struct-~3estring%29%29">styled-struct-&gt;string</a></td>
> </tr>
> <tr class="odd">
> <td>    (<a href="#%28def._%28%28lib._rash%2Fprompt-helpers%2Fstring-style..rkt%29._create-styled-struct%29%29">create-styled-struct</a></td>
> </tr>
> <tr class="even">
> <td>     "Green and bg blue."</td>
> </tr>
> <tr class="odd">
> <td>     (<a href="#%28def._%28%28lib._rash%2Fprompt-helpers%2Fstring-style..rkt%29._create-styled-struct%29%29">create-styled-struct</a></td>
> </tr>
> <tr class="even">
> <td>      "green but bg yellow and underlined."</td>
> </tr>
> <tr class="odd">
> <td>      #:bg "yellow"</td>
> </tr>
> <tr class="even">
> <td>      #:underlined? #t)</td>
> </tr>
> <tr class="odd">
> <td>     " Green and bg blue again."</td>
> </tr>
> <tr class="even">
> <td>     #:fg "green"</td>
> </tr>
> <tr class="odd">
> <td>     #:bg "blue")))</td>
> </tr>
> </tbody>
> </table></td>
> </tr>
> <tr class="even">
> <td>&gt; (<a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=regexp.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._regexp-split%2529%2529&amp;version=8.4">regexp-split</a> #px"\\." example1) ; so it fits on the screen</td>
> </tr>
> <tr class="odd">
> <td><table>
> <tbody>
> <tr class="odd">
> <td><p>'("\e[0m\e[32m\e[44mGreen and bg blue"</p></td>
> </tr>
> <tr class="even">
> <td><p>  "\e[0m\e[32m\e[43m\e[4mgreen but bg yellow and underlined"</p></td>
> </tr>
> <tr class="odd">
> <td><p>  "\e[0m\e[0m\e[32m\e[44m Green and bg blue again"</p></td>
> </tr>
> <tr class="even">
> <td><p>  "\e[0m")</p></td>
> </tr>
> </tbody>
> </table></td>
> </tr>
> <tr class="even">
> <td><table>
> <tbody>
> <tr class="odd">
> <td>&gt; (<a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=8.4">define</a> example2</td>
> </tr>
> <tr class="even">
> <td>    (<a href="#%28def._%28%28lib._rash%2Fprompt-helpers%2Fstring-style..rkt%29._styled-struct-~3estring%29%29">styled-struct-&gt;string</a></td>
> </tr>
> <tr class="odd">
> <td>     (<a href="#%28def._%28%28lib._rash%2Fprompt-helpers%2Fstring-style..rkt%29._create-styled-struct%29%29">create-styled-struct</a></td>
> </tr>
> <tr class="even">
> <td>      #:underlined? #t</td>
> </tr>
> <tr class="odd">
> <td>      #:bg "blue"</td>
> </tr>
> <tr class="even">
> <td>      "Underlined."</td>
> </tr>
> <tr class="odd">
> <td>      (<a href="#%28def._%28%28lib._rash%2Fprompt-helpers%2Fstring-style..rkt%29._create-styled-struct%29%29">create-styled-struct</a></td>
> </tr>
> <tr class="even">
> <td>       #:underlined? #f</td>
> </tr>
> <tr class="odd">
> <td>       "Not underlined.")</td>
> </tr>
> <tr class="even">
> <td>      "Underlined."</td>
> </tr>
> <tr class="odd">
> <td>      (<a href="#%28def._%28%28lib._rash%2Fprompt-helpers%2Fstring-style..rkt%29._create-styled-struct%29%29">create-styled-struct</a></td>
> </tr>
> <tr class="even">
> <td>       #:reset-before? #t</td>
> </tr>
> <tr class="odd">
> <td>       "\n"))))</td>
> </tr>
> </tbody>
> </table></td>
> </tr>
> <tr class="odd">
> <td>&gt; (<a href="https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&amp;rel=regexp.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._regexp-split%2529%2529&amp;version=8.4">regexp-split</a> #px"\\." example2)</td>
> </tr>
> <tr class="even">
> <td><table>
> <tbody>
> <tr class="odd">
> <td><p>'("\e[0m\e[44m\e[4mUnderlined"</p></td>
> </tr>
> <tr class="even">
> <td><p>  "\e[0m\e[44mNot underlined"</p></td>
> </tr>
> <tr class="odd">
> <td><p>  "\e[0m\e[0m\e[44m\e[4mUnderlined"</p></td>
> </tr>
> <tr class="even">
> <td><p>  "\e[0m\n\e[0m\e[0m")</p></td>
> </tr>
> </tbody>
> </table></td>
> </tr>
> </tbody>
> </table>

#### 6.2` `[]{#(part._.Git_functions)}Git functions

There are also some useful functions that help gather git information.

Remember -- these functions are unstable, and may change.

You can use them with (require rash/prompt-helpers/git-info)

Returns the git root directory of dir.

Returns the current branch of dir.

Determines if current branch has untracked files.

Determines whether there are uncommited changes (staged or unstaged) to tracked files in the current branch of the git repository containing dir.

Determines whether there are uncommited changes within submodules of the git repository that contains dir.

Determines if current branch is tracking a remote branch.

Return the current commit.

Returns a list with the number of commits behind and ahead, in that order, that the current branch is in relation to its corresponding upstream branch.

Returns a hash with info from above git functions that finished executing within timeout seconds.

The hash contains the following key-value pairs if all operations complete before the timeout:

-   \'root to the result of [git-root](#%28def._%28%28lib._rash%2Fprompt-helpers%2Fgit-info..rkt%29._git-root%29%29)

-   \'branch to the result of [git-branch](#%28def._%28%28lib._rash%2Fprompt-helpers%2Fgit-info..rkt%29._git-branch%29%29)

-   \'untracked? to the result of [git-has-untracked?](#%28def._%28%28lib._rash%2Fprompt-helpers%2Fgit-info..rkt%29._git-has-untracked~3f%29%29)

-   \'dirty? to the result of [git-dirty?](#%28def._%28%28lib._rash%2Fprompt-helpers%2Fgit-info..rkt%29._git-dirty~3f%29%29)

-   \'submodule-dirty? to the result of [git-submodule-dirty?](#%28def._%28%28lib._rash%2Fprompt-helpers%2Fgit-info..rkt%29._git-submodule-dirty~3f%29%29)

-   \'remote-tracking? to the result of [git-remote-tracking?](#%28def._%28%28lib._rash%2Fprompt-helpers%2Fgit-info..rkt%29._git-remote-tracking~3f%29%29)

-   \'behind to the [car](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._car%2529%2529&version=8.4) of the result of [git-behind/ahead-numbers](#%28def._%28%28lib._rash%2Fprompt-helpers%2Fgit-info..rkt%29._git-behind%2Fahead-numbers%29%29)

-   \'ahead to the [cadr](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._cadr%2529%2529&version=8.4) of the result of [git-behind/ahead-numbers](#%28def._%28%28lib._rash%2Fprompt-helpers%2Fgit-info..rkt%29._git-behind%2Fahead-numbers%29%29)

-   \'timeout? to \#t if the operation timed out before gathering all data, otherwise \#f

If the timeout is reached before all information is gathered, the hash is returned with only those elements that were completed.

### 7` `[]{#(part._.Demo_stuff_reference)}Demo stuff reference

Nothing in the demo directory is remotely stable! It can all change or go away at any moment.
The stuff documented here is in the rash-demos package. Maybe I should move this documentation into that package\...

I've written various pipeline operators and line macros that I use, but I haven't decided what should be in the default language yet. So for now they are sitting in a demo directory. But I need some examples. So here I'm documenting a bit.

Use it with (require rash/demo/setup).

Sugar to flatten mapping.

Eg.

is equivalent to

The [\_](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529.__%2529%2529&version=8.4) argument is appended to =map='s argument list if it is not written explicitly.

Unstable in that it will probably be moved into the default rash module rather than the demo module.

Sugar to flatten filtering.

Eg.

is equivalent to

The [\_](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=shell-pipeline&rel=pipeline-macro.html%23%2528form._%2528%2528lib._shell%252Fpipeline-macro..rkt%2529.__%2529%2529&version=8.4) argument is appended to =filter='s argument list if it is not written explicitly.

Unstable in that it will probably be moved into the default rash module rather than the demo module.

Dollar and glob expands the directory, then executes the body with [current-directory](https://download.racket-lang.org/releases/8.4/doc/local-redirect/index.html?doc=reference&rel=Filesystem.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._current-directory%2529%2529&version=8.4) parameterized to the result of expanding directory. If glob expansion returns multiple results, the body is executed once for each of them.

Eg.

>   -----------------------------
>   in-dir \$HOME/projects/\* {
>     make clean
>     make
>   }
>   -----------------------------

This is unstable in that the way it does globbing and dollar expansion may change, the way it handles globs that resolve to something that is not a directory may change, and it will probably be moved into the default rash module rather than the demo directory.

Simply returns the expression. This is just to work around not having access to top-level unparenthesized variables.

### 8` `[]{#(part._.Code_and_.License)}Code and License

The code is available
[on github](https://github.com/willghatch/racket-rash).

This library is licensed under the terms of the LGPL version 3, or (at
your option) any later version published by the Free Software
Foundation (IE LGPL3+).
